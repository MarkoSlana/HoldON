<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:HoldON.ViewModels"
             xmlns:converters="clr-namespace:HoldON.Converters"
             x:DataType="viewmodels:CommunityViewModel"
             x:Class="HoldON.Views.CommunityPage"
             BackgroundColor="{StaticResource Background}">

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">
            <!-- Header -->
            <Label Text="Skupnost"
                   FontSize="28"
                   TextColor="{StaticResource White}"
                   FontAttributes="Bold"/>

            <!-- Search Bar -->
            <Frame BackgroundColor="{StaticResource Surface}"
                   BorderColor="Transparent"
                   CornerRadius="15"
                   Padding="15,10"
                   HasShadow="False">
                <Grid ColumnDefinitions="Auto, *">
                    <Label Grid.Column="0"
                           Text="ðŸ”"
                           FontSize="18"
                           VerticalOptions="Center"
                           Margin="0,0,10,0"/>
                    <Entry Grid.Column="1"
                           Placeholder="IÅ¡Äi prijatelje..."
                           PlaceholderColor="{StaticResource Gray400}"
                           TextColor="{StaticResource White}"
                           BackgroundColor="Transparent"
                           Text="{Binding SearchText}"/>
                </Grid>
            </Frame>

            <!-- Tabs -->
            <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                <Frame Grid.Column="0"
                       Padding="0"
                       HasShadow="False"
                       CornerRadius="20"
                       BorderColor="Transparent">
                    <Frame.BackgroundColor>
                        <Binding Path="ShowFriends">
                            <Binding.Converter>
                                <converters:BoolToColorConverter x:TypeArguments="Color"
                                    TrueValue="White"
                                    FalseValue="Transparent"/>
                            </Binding.Converter>
                        </Binding>
                    </Frame.BackgroundColor>
                    <Button Text="Prijatelji"
                            Command="{Binding ShowFriendsTabCommand}"
                            BackgroundColor="Transparent"
                            HeightRequest="45"
                            FontAttributes="Bold">
                        <Button.TextColor>
                            <Binding Path="ShowFriends">
                                <Binding.Converter>
                                    <converters:BoolToColorConverter x:TypeArguments="Color"
                                        TrueValue="#0F1419"
                                        FalseValue="White"/>
                                </Binding.Converter>
                            </Binding>
                        </Button.TextColor>
                    </Button>
                </Frame>
                <Frame Grid.Column="1"
                       Padding="0"
                       HasShadow="False"
                       CornerRadius="20"
                       BorderColor="Transparent">
                    <Frame.BackgroundColor>
                        <Binding Path="ShowLeaderboard">
                            <Binding.Converter>
                                <converters:BoolToColorConverter x:TypeArguments="Color"
                                    TrueValue="White"
                                    FalseValue="Transparent"/>
                            </Binding.Converter>
                        </Binding>
                    </Frame.BackgroundColor>
                    <Button Text="Lestvica"
                            Command="{Binding ShowLeaderboardTabCommand}"
                            BackgroundColor="Transparent"
                            HeightRequest="45"
                            FontAttributes="Bold">
                        <Button.TextColor>
                            <Binding Path="ShowLeaderboard">
                                <Binding.Converter>
                                    <converters:BoolToColorConverter x:TypeArguments="Color"
                                        TrueValue="#0F1419"
                                        FalseValue="White"/>
                                </Binding.Converter>
                            </Binding>
                        </Button.TextColor>
                    </Button>
                </Frame>
            </Grid>

            <!-- Friends View -->
            <VerticalStackLayout Spacing="15" IsVisible="{Binding ShowFriends}">
                <!-- Friends List -->
                <CollectionView ItemsSource="{Binding Friends}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:Friend">
                            <Frame Style="{StaticResource StrongerCard}"
                                   Padding="15"
                                   Margin="0,0,0,10">
                                <Grid ColumnDefinitions="Auto, *, Auto, Auto">
                                    <!-- Avatar -->
                                    <Frame Grid.Column="0"
                                           HeightRequest="50"
                                           WidthRequest="50"
                                           CornerRadius="25"
                                           Padding="0"
                                           BackgroundColor="{StaticResource White}"
                                           BorderColor="Transparent"
                                           HasShadow="False"
                                           Margin="0,0,15,0">
                                        <Label Text="{Binding Initials}"
                                               TextColor="{StaticResource Background}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Frame>

                                    <!-- Info -->
                                    <VerticalStackLayout Grid.Column="1" Spacing="5" VerticalOptions="Center">
                                        <Label Text="{Binding Name}"
                                               TextColor="{StaticResource White}"
                                               FontSize="16"
                                               FontAttributes="Bold"/>
                                        <Label Text="{Binding WorkoutsThisWeek}"
                                               TextColor="{StaticResource Gray400}"
                                               FontSize="12"/>
                                    </VerticalStackLayout>

                                    <!-- Trophy Icon -->
                                    <Label Grid.Column="2"
                                           Text="ðŸ†"
                                           FontSize="24"
                                           IsVisible="{Binding IsTopPerformer}"
                                           VerticalOptions="Center"
                                           Margin="0,0,10,0"/>

                                    <!-- Best Lift -->
                                    <Label Grid.Column="3"
                                           Text="{Binding BestLift}"
                                           TextColor="{StaticResource Tertiary}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Add Friend Button -->
                <Button Text="ðŸ‘¥  Dodaj prijatelja"
                        Command="{Binding AddFriendCommand}"
                        BackgroundColor="{StaticResource White}"
                        TextColor="{StaticResource Background}"
                        CornerRadius="20"
                        HeightRequest="50"
                        FontAttributes="Bold"/>

                <!-- Recent Activity -->
                <Label Text="Nedavna aktivnost"
                       TextColor="{StaticResource White}"
                       FontSize="18"
                       FontAttributes="Bold"
                       Margin="0,10,0,0"/>

                <CollectionView ItemsSource="{Binding Activities}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:FriendActivity">
                            <Frame Style="{StaticResource StrongerCard}"
                                   Padding="15"
                                   Margin="0,0,0,10">
                                <Grid ColumnDefinitions="Auto, *">
                                    <!-- Avatar -->
                                    <Frame Grid.Column="0"
                                           HeightRequest="45"
                                           WidthRequest="45"
                                           CornerRadius="22.5"
                                           Padding="0"
                                           BackgroundColor="{StaticResource White}"
                                           BorderColor="Transparent"
                                           HasShadow="False"
                                           Margin="0,0,15,0">
                                        <Label Text="{Binding Initials}"
                                               TextColor="{StaticResource Background}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Frame>

                                    <!-- Activity Info -->
                                    <VerticalStackLayout Grid.Column="1" Spacing="5">
                                        <HorizontalStackLayout Spacing="5">
                                            <Label Text="{Binding Name}"
                                                   TextColor="{StaticResource White}"
                                                   FontSize="14"
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding Activity}"
                                                   TextColor="{StaticResource Gray400}"
                                                   FontSize="14"/>
                                        </HorizontalStackLayout>
                                        <Label Text="{Binding Detail}"
                                               TextColor="{StaticResource Primary}"
                                               FontSize="13"/>
                                        <Label Text="{Binding Time}"
                                               TextColor="{StaticResource Gray500}"
                                               FontSize="11"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

            <!-- Leaderboard View -->
            <VerticalStackLayout Spacing="15" IsVisible="{Binding ShowLeaderboard}">
                <!-- Exercise Filter Chips -->
                <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never">
                    <HorizontalStackLayout Spacing="10">
                        <Button Text="Bench press"
                                Command="{Binding SelectExerciseCommand}"
                                CommandParameter="Bench press"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="{StaticResource White}"
                                CornerRadius="20"
                                HeightRequest="40"
                                Padding="20,0"/>
                        <Button Text="PoÄep"
                                Command="{Binding SelectExerciseCommand}"
                                CommandParameter="PoÄep"
                                BackgroundColor="{StaticResource Surface}"
                                TextColor="{StaticResource White}"
                                CornerRadius="20"
                                HeightRequest="40"
                                Padding="20,0"/>
                        <Button Text="Mrtvi dvig"
                                Command="{Binding SelectExerciseCommand}"
                                CommandParameter="Mrtvi dvig"
                                BackgroundColor="{StaticResource Surface}"
                                TextColor="{StaticResource White}"
                                CornerRadius="20"
                                HeightRequest="40"
                                Padding="20,0"/>
                    </HorizontalStackLayout>
                </ScrollView>

                <!-- Leaderboard Title -->
                <Label Text="NajboljÅ¡i dvigovalci"
                       TextColor="{StaticResource White}"
                       FontSize="18"
                       FontAttributes="Bold"/>

                <!-- Leaderboard List -->
                <CollectionView ItemsSource="{Binding Leaderboard}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:LeaderboardEntry">
                            <Frame Padding="15"
                                   Margin="0,0,0,10"
                                   HasShadow="False"
                                   CornerRadius="15"
                                   BorderColor="Transparent">
                                <Frame.BackgroundColor>
                                    <Binding Path="IsCurrentUser">
                                        <Binding.Converter>
                                            <converters:BoolToColorConverter x:TypeArguments="Color"
                                                TrueValue="#1E3A8A"
                                                FalseValue="#1A1F2E"/>
                                        </Binding.Converter>
                                    </Binding>
                                </Frame.BackgroundColor>
                                <Grid ColumnDefinitions="Auto, Auto, *, Auto, Auto">
                                    <!-- Rank Badge or Number -->
                                    <Label Grid.Column="0"
                                           Text="{Binding RankBadge}"
                                           FontSize="24"
                                           IsVisible="{Binding ShowRankBadge}"
                                           VerticalOptions="Center"
                                           Margin="0,0,15,0"/>
                                    <VerticalStackLayout Grid.Column="0"
                                                         IsVisible="{Binding ShowRankBadge, Converter={StaticResource InvertBoolConverter}}"
                                                         VerticalOptions="Center"
                                                         Margin="0,0,15,0">
                                        <Label Text="#"
                                               TextColor="{StaticResource Gray400}"
                                               FontSize="10"
                                               HorizontalTextAlignment="Center"/>
                                        <Label Text="{Binding Rank}"
                                               TextColor="{StaticResource Gray400}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               HorizontalTextAlignment="Center"/>
                                    </VerticalStackLayout>

                                    <!-- Avatar -->
                                    <Frame Grid.Column="1"
                                           HeightRequest="45"
                                           WidthRequest="45"
                                           CornerRadius="22.5"
                                           Padding="0"
                                           BackgroundColor="{StaticResource White}"
                                           BorderColor="Transparent"
                                           HasShadow="False"
                                           Margin="0,0,15,0">
                                        <Label Text="{Binding Initials}"
                                               TextColor="{StaticResource Background}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Frame>

                                    <!-- Name -->
                                    <HorizontalStackLayout Grid.Column="2" Spacing="8" VerticalOptions="Center">
                                        <Label Text="{Binding Name}"
                                               TextColor="{StaticResource White}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"/>
                                        <Frame BackgroundColor="{StaticResource Primary}"
                                               Padding="8,2"
                                               CornerRadius="10"
                                               HasShadow="False"
                                               BorderColor="Transparent"
                                               IsVisible="{Binding IsCurrentUser}"
                                               VerticalOptions="Center">
                                            <Label Text="Vi"
                                                   TextColor="{StaticResource White}"
                                                   FontSize="10"
                                                   FontAttributes="Bold"/>
                                        </Frame>
                                    </HorizontalStackLayout>

                                    <!-- Trend Icon -->
                                    <Label Grid.Column="3"
                                           Text="ðŸ“ˆ"
                                           FontSize="20"
                                           IsVisible="{Binding HasTrend}"
                                           VerticalOptions="Center"
                                           Margin="0,0,10,0"/>

                                    <!-- Weight -->
                                    <Label Grid.Column="4"
                                           Text="{Binding Weight}"
                                           TextColor="{StaticResource White}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>

            <BoxView HeightRequest="20"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
